
<nav class="navbar navbar-expand-lg navbar-light bg-light">
	<style>
		a, a:hover, a:focus, a:active {
		text-decoration: none;
		color: inherit;
		}
		.popover{
			max-width: 400px;
			max-height: 400px;
		}
    	.main, .text-primary{
			color: #182030!important;
		}
		.badge, .w-100{
			background-color: #182030!important;
		}
		.cart-button{
			color: #182030; vertical-align:middle; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;      font-size: 120%;      height: 45px; width: 110px;     margin-top: 2px;
		}
	</style>

	<div class="container-fluid">
	<a class="navbar-brand" href="http://localhost:4000/"><img src="../../images/logo_text.png"  width="250px" alt="Musée des Astres" style="margin-left: 30px!important"/></a>

	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarNavDropdown" style="padding-top:50px; margin-bottom: -15px;">
		<ul class="navbar-nav me-auto">
			<li class="nav-item">
				<a class="nav-link" aria-current="page" href="/">Accueil</a>
			</li>

		  <li class="nav-item dropdown">
			<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">Expériences</a>
			<div class="dropdown-menu">
				<a class="dropdown-item navsoussection" href="/expositions">Expositions saisonnières</a>
				<a class="dropdown-item navsoussection" href="/activites">Activités</a>
				<a class="dropdown-item navsoussection" href="/rdv_etoiles"><i>Rendez-vous sous les étoiles</i></a>
			</div>
			</li>

			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">Information</a>
				<div class="dropdown-menu">
					<a class="dropdown-item navsoussection" href="/plan">Plan du musée</a>
					<a class="dropdown-item navsoussection" href="/info">Coordonnées</a>
				</div>
			</li>

			<li class="nav-item">
				<a class="nav-link" href="/billeterie">Billetterie</a>
			</li>

			<li class="nav-item">
				<a class="nav-link" href="/boutique">Boutique</a>
			</li>
		</ul>

		<ul style="padding-top:10px; ">
			<li class="nav-item me-auto" style="margin-right: 30px!important;">
				<a  tabindex="0" id="content-desktop" role="button" data-toggle="popover_cart" data-bs-trigger="focus">
					<button type="button" class="btn btn-light cart-button position-relative">
					<i class="fa-solid fa-cart-shopping" style="color: #182030;"></i>
					Panier
					<span id="cart-number" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="background-color: red!important;">
					  0
					</span>
				  </button>
				</a>

				<a href="/checkout" style="text-decoration: none; color: inherit;"><button id="content-mobile"
					class="btn btn-light cart-button" >
					<i class="fa-solid fa-cart-shopping" style="color: #182030;"></i>
					Panier
				</button>
			</a>
			</a>
			</li>
	  </ul>

	  </div>
	</div>
  </nav>

  <script>		
	let num = document.getElementById('cart-number');
	num.innerText= sessionStorage.length;
  </script>
  <script>

  function getcart (){
	var headers = {"Content-Type": "application/json","Access-Control-Origin": "*", "Expires": ""}
	var data = [];
  for (let i = 0; i < sessionStorage.length; i++) {
	  data[i] = sessionStorage.getItem(i);
  };

			console.debug(" data : "+ data);
			console.debug("data Json : " + JSON.stringify((Object.assign({}, data))));

			return fetch("/cart", {
			  method: "POST",
			  headers: headers,
			  body:  JSON.stringify((Object.assign({}, data)))
			})

			.then(response => response.json())
			.then(data => {
			  //create main cart node
			  let racine = document.createElement('div');
			  racine.classList.add('col-sm-12', 'order-md-last');

			  //create header cart node
			  let cartHeader = document.createElement('h4');
			  cartHeader.classList.add('d-flex', 'justify-content-between', 'align-items-center', 'mb-3');

			  //create header title cart node
			  let cartTitre = document.createElement('span');
			  cartTitre.classList.add('text-primary');
			  cartTitre.innerText= "Votre Panier";

			  //create header items cart node
			  let nbitems = document.createElement('span');
			  nbitems.classList.add('badge', 'bg-primary', 'rounded-pill');
			  nbitems.innerText = data.length;

			  //create list Items cart node
			  let listItems = document.createElement('ul');
			  listItems.classList.add('list-group','mb-3');

			  let prixTotHT = 0;

			  for (const Items of data) {

				prixTotHT= prixTotHT+Items.prix;

				let listItem = document.createElement('li');

				listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'lh-sm');

				let indiv = document.createElement('div');

				let Titre = document.createElement('h6');
				Titre.classList.add('my-0');
				Titre.innerText = Items.titre;

				let Descrip = document.createElement('small');
				Descrip.classList.add('text-muted');
				Descrip.innerText = Items.desc;

				let Prix = document.createElement('span');
				Prix.classList.add('text-muted');
				Prix.innerText = "$ " +Items.prix;

				indiv.appendChild(Titre);
				indiv.appendChild(Descrip);

				listItem.appendChild(indiv);
				listItem.appendChild(Prix);

				listItems.appendChild(listItem);
			  }
			  let total = document.createElement('li');
			  total.classList.add('list-group-item', 'd-flex', 'justify-content-between');

			  let textTotal = document.createElement('span');
			  textTotal.innerText = "Total (CAD)";

			  let prixTotal = document.createElement('strong');
			  prixTotal.innerText = "$ "+prixTotHT.toFixed(2);
			  console.debug(prixTotHT);

			  total.appendChild(textTotal);
			  total.appendChild(prixTotal);

			  listItems.appendChild(total);

			  cartHeader.appendChild(cartTitre);
			  cartHeader.appendChild(nbitems);

			  racine.appendChild(cartHeader);
			  racine.appendChild(listItems);
			  console.debug(racine.outerHTML);
			  return racine.outerHTML;
			})
			.catch(console.error);
  }

  </script>
<script>


    $(document).ready(async function () {
	getcart().then(data => {
		console.debug('toto');
		console.debug(data);

		$('[data-toggle="popover_cart"]').popover({
			placement: 'bottom',
			trigger: 'focus',
			html: true,
			sanitize: false,
			animation:true,
			content: `<a href="/checkout">`+data+`</a>`
		});

	});
	});


</script>
